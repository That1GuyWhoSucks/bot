import discord
import asyncio
from discord.ext import commands
import random
import json
import math
from discord.utils import get
from pytz import UTC
import chatterbot
from chatterbot.trainers import ChatterBotCorpusTrainer
from chatterbot import ChatBot
from chatterbot.trainers import ListTrainer
import socket

chatbot = ChatBot("Your Mom")
intents = discord.Intents.default()
intents.members = True
bot = commands.Bot(command_prefix='!!', intents=intents)
masspinger = False
trashtalker = False
truemess: bool = True
chat: bool = False
totalcardlist: list
worduse = 0
with open('memes.json', 'r') as x:
    memelist = json.load(x)
    x.close()
badwordlist : list = ["stab", "you"]
bot.remove_command("help")
with open('guilds.json', 'r') as n:
    guildstuff = json.load(n)
    n.close() #first num is staff thing 2nd is starboard 3rd floorboard
x = 1
if x == 0: #just use if need more stuff for bot
    print("here we go")
    with open('yes.txt', 'r', encoding="utf-8") as k:
        lines = k.readlines()
        k.close()
    goodlines: list = [line for line in lines if not line.startswith("pizza")]
    print("done")
    with open('badbrains.json', 'w') as k:
        json.dump(goodlines, k)
        k.close()
    print("now we done")
    corpustrainer = ChatterBotCorpusTrainer(chatbot)
    corpustrainer.train('chatterbot.corpus.english')
with open('badbrains.json', 'r') as l: #pizza mode
    conversation = json.load(l)
    l.close()
trainer = ListTrainer(chatbot)
trainer.train(conversation)
@bot.check
async def channel_check(ctx):
    if not str(ctx.channel.id) == "820402189548650536":
        return True


@bot.command()
async def chat(ctx):
    global chat
    chat = True
    await ctx.send("Hello")
    while True:
        acereturnmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
        if str(acereturnmsg.content).lower() == "stop":
            break
        elif not chat:
            break
        await ctx.send(chatbot.get_response(str(acereturnmsg.content)))
        if not str(acereturnmsg.content) in conversation:
            conversation.append(acereturnmsg.content)
    with open('badbrains.json', 'w') as l:
        json.dump(conversation, l)
        l.close()
    trainer.train(conversation)

@bot.command()
@commands.has_role("God")
async def status(ctx, number, game):
    await ctx.message.delete()
    activity = discord.Game(name=str(game))
    if int(number) == 1:
        await bot.change_presence(status=discord.Status.online, activity=activity)
    elif int(number) == 2:
        await bot.change_presence(status=discord.Status.idle, activity=activity)
    elif int(number) == 3:
        await bot.change_presence(status=discord.Status.do_not_disturb, activity=activity)
    elif int(number) == 4:
        await bot.change_presence(status=discord.Status.invisible, activity=activity)


async def aceswitcher(ctx, playercardlist, acelist, playertotalpoints):
    acemsg = "Your aces are, "
    for x in range(len(acelist)):
        acemsg = str(acemsg) + f"A {acelist[int(x)][2]} of {acelist[int(x)][1]} worth {acelist[int(x)][0]} points, "
    acemsg = str(
        acemsg) + " what ace would you like to change the values of? (input a number starting from one to the ace you want to edit)"
    await ctx.send(acemsg)
    acereturnmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
    if int(acelist[int(acereturnmsg.content) - 1][0]) == int(1):
        acelist[int(acereturnmsg.content) - 1][0] = 11
        playercardlist[(acelist[int(acereturnmsg.content) - 1][3])][0] = 11
    elif int(acelist[int(acereturnmsg.content) - 1][0]) == int(11):
        acelist[int(acereturnmsg.content) - 1][0] = 1
        playercardlist[(acelist[int(acereturnmsg.content) - 1][3])][0] = 1
    playertotalpoints = 0
    for x in range(len(playercardlist)):
        playertotalpoints = int(playertotalpoints) + int(playercardlist[x][0])
    if playertotalpoints > 21:  # 21 check
        if not acelist == []:
            for x in range(len(acelist)):
                if int(acelist[x][0]) == int(11) and int(playertotalpoints) > int(21):
                    acelist[x][0] = 1
                    playertotalpoints = int(playertotalpoints) - 10
                    await ctx.send(f"Your {acelist[x][2]} of {acelist[x][1]} was changed to be worth 1 point to try to save you from breaking, points = {playertotalpoints}")
                else:
                    break
    if playertotalpoints > 21:
        playerpast21 = True
    else:
        playerpast21 = False
    return playertotalpoints, playercardlist, acelist


async def goodend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message, dealerfnlpoints, playertotalpoints):
    for x in range(1):
        if insurance:
            fnl_message = str(
                fnl_message) + f" Bad insurance purchase, lose {insurancemoney} points."
        if surrender:
            points = int(points) - math.floor(int(bettedpoints) / 2)
            fnl_message = str(
                fnl_message) + f"Ohh bad surrender, still lost half your points though dont worry ;), you lost {math.floor(int(bettedpoints) / 2)} points to your new total of {points} points."
            await ctx.send(fnl_message)
            break
        points = int(points) - int(bettedpoints)
        if int(playertotalpoints) == int(21):
            bettedpoints = int(bettedpoints) * 3
        else:
            bettedpoints = int(bettedpoints) * 2
        if doubledown:
            bettedpoints = int(bettedpoints) * 2
            fnl_message = str(fnl_message) + f" Good double down! Gain {bettedpoints} points!"
        points = int(points) + int(bettedpoints)
        fnl_message = str(fnl_message) + f" You now have {points} points."
        await ctx.send(fnl_message)
        return points



async def badend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message, dealerfnlpoints):
    for x in range(1):
        if insurance:
            if int(dealerfnlpoints) == int(21):
                fnl_message = str(
                    fnl_message) + f" Good insurance purchase, gain {insurancemoney} points."
                points = int(insurancemoney) * 4
            else:
                fnl_message = str(
                    fnl_message) + f" Bad insurance purchase, lose {insurancemoney} points."
        if surrender:
            points = int(points) - (int(bettedpoints) / 2)
            await ctx.send(
                f"Good surrender you lost {math.floor(int(bettedpoints) / 2)} points to your new total of {points} points.")
            break
        if doubledown:
            bettedpoints = int(bettedpoints) * 2
            fnl_message = str(fnl_message) + f" That sucks! Lose {bettedpoints} points!"
        points = int(points) - int(bettedpoints)
        fnl_message = str(fnl_message) + f" You now have {points} points"
        await ctx.send(fnl_message)
        return points


async def neutralend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message, dealerfnlpoints):
    for x in range(1):
        if insurance:
            if int(dealerfnlpoints) == int(21):
                fnl_message = str(
                    fnl_message) + f" Good insurance purchase, gain {insurancemoney} points."
                points = int(insurancemoney) * 4
            else:
                fnl_message = str(
                    fnl_message) + f" Bad insurance purchase, lose {insurancemoney} points."
        if surrender:
            points = int(points) - (int(bettedpoints) / 2)
            await ctx.send(
                f"Looks like we tied, still lost half your points though dont worry ;), you lost {int(bettedpoints) / 2} to your new total of {points} points.")
            break
        if doubledown:
            fnl_message = str(fnl_message) + " Couldve been a lot worse with that double down"
        fnl_message = str(fnl_message) + f" You now have {points} points"
        await ctx.send(fnl_message)
        return points


async def acechecker(x: list, ctx):
    await ctx.send(
        f"Would you like your {x[2]} of {x[1]} to be worth 11 points or 1 point?")
    newmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
    if int(newmsg.content) == int(11):
        await ctx.send("Alright its worth 11 points")
    elif int(newmsg.content) == int(1):
        await ctx.send("Alright its worth 1 point")
        x[0] = 1
    return x


async def blackjack3rdturn(ctx, playercardlist: list, playertotalpoints: int, playertimenum: int, cardlistcontent, acelist):
    if int(playercardlist[(int(playertimenum) - 1)][0]) == int(11):  # checking for ace
        await acechecker(playercardlist[int(playertimenum) - 1], ctx)
        playercardlist[(int(playertimenum) - 1)].append(int(playertimenum) - 1)
        playercardlist[(int(playertimenum) - 1)].append(int(playertimenum) - 1)
        acelist.append(playercardlist[int(playertimenum) - 1])
    playertotalpoints = int(playertotalpoints) + int(playercardlist[(int(playertimenum) - 1)][0])  # points calc
    cardlistcontent = cardlistcontent + f"A {playercardlist[(int(playertimenum) - 1)][2]} of {playercardlist[(int(playertimenum) - 1)][1]}, "
    await ctx.send(
        f"You have {cardlistcontent} points = {playertotalpoints}")
    if playertotalpoints > 21:  # 21 check
        if not acelist == []:
            for x in range(len(acelist)):
                if int(acelist[x][0]) == int(11) and int(playertotalpoints) > int(21):
                    acelist[x][0] = 1
                    playertotalpoints = int(playertotalpoints) - 10
                    await ctx.send(f"Your {acelist[x][2]} of {acelist[x][1]} was changed to be worth 1 point to save you from breaking, points = {playertotalpoints}")
                else:
                    break
    if playertotalpoints > 21:
        playerpast21 = True
    else:
        playerpast21 = False
    return playerpast21, playertotalpoints, cardlistcontent, acelist


@bot.command()
async def points(ctx):
    with open('gambleid2.json', 'r') as f:
        gambleidlist = json.load(f)
        f.close()
    if str(ctx.author.id) not in gambleidlist.keys():
        gambleidlist.update({str(ctx.author.id): 1000})
        await ctx.send(f"first time eh? {ctx.author}")
        with open('gambleid2.json', 'w') as f:
            json.dump(gambleidlist, f)
            f.close()
    with open('gambleid2.json', 'r') as f:
        gambleidlist = json.load(f)
        f.close()
    if int(gambleidlist[str(ctx.author.id)]) == int(0):
        await ctx.send("your broke! you have no points!")
    else:
        await ctx.send(f"You have {gambleidlist[str(ctx.author.id)]} points")


@bot.command()
async def chair(ctx):
    await ctx.send("There are approximately 1,010,300 words in the English language, but I could never string enough words together to properly express how much I want to hit you with a chair")


@bot.command()
async def help(ctx):
    await ctx.send("current commands (prefix !!) \ntimer \nblackjack \nrandmeme \ngoogleit \nshutup (input = ping)\nsickbeats \nbully (inputs = command number ping 'message') \npoints \nloan \ndebt \nrandquote \nchair")


@bot.command()
async def debt(ctx):
    with open('gambleid2.json', 'r') as f:
        gambleidlist = json.load(f)
        f.close()
    with open('debters.json', 'r') as z:
        debters1 = json.load(z)
        z.close()
    await ctx.send(f"You have {gambleidlist[str(ctx.author.id)]} points and owe {debters1[str(ctx.author.id)]} points, how many points would you like to put towards your debt?")
    somestr = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
    if int(somestr.content) > int(gambleidlist[str(ctx.author.id)]):
        await ctx.send("dont pay more than you own")
    elif int(somestr.content) < int(0):
        await ctx.send("dont pay negative money")
    else:
        gambleidlist[str(ctx.author.id)] = int(gambleidlist[str(ctx.author.id)]) - int(somestr.content)
        debters1[str(ctx.author.id)] = int(debters1[str(ctx.author.id)]) - int(somestr.content)
        if int(debters1[str(ctx.author.id)]) == int(0):
            await ctx.send(f"You paid off your debt! You have {gambleidlist[str(ctx.author.id)]} points left!")
        else:
            await ctx.send(f"you owe {debters1[str(ctx.author.id)]} points and have {gambleidlist[str(ctx.author.id)]}")
        with open('gambleid2.json', 'w') as f:
            json.dump(gambleidlist, f)
            f.close()
        with open('debters.json', 'w') as z:
            json.dump(debters1, z)
            z.close()


@bot.command()
async def timer(ctx):
    await ctx.send("please send 3 numbers representing hours minutes and seconds respectively ")
    somestr: str = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
    somelist: list = somestr.content.split()
    h: int = somelist[0]
    m: int = somelist[1]
    s: int = somelist[2]
    try:
        await ctx.send(f"time accepted")
        await asyncio.sleep(int(h) * 60 * 60 + int(m) * 60 + int(s))
        await ctx.send(f"Timer's up, {ctx.author.mention}")
    except commands.MissingRequiredArgument:
        await ctx.send("enter 3 numbers seperated by spaces for hours minutes and seconds respectively")


@bot.command()
async def randmeme(ctx):
    await ctx.send(f"{str(len(memelist))} memes are currently in my database \n{str(random.choice(memelist))}")

#shut up command https://cdn.discordapp.com/attachments/441463102605754368/714557308448800799/stfu.mp4
#friday command https://media.discordapp.net/attachments/597597160292483074/738791749287280720/WhatDayIsit.png?width=673&height=701
#https://media.discordapp.net/attachments/597597160292483074/738791577308364962/FRIDAY.png?width=714&height=701
@bot.command()
async def shutup(ctx, people):
    await ctx.send(f"{people} \n https://cdn.discordapp.com/attachments/441463102605754368/714557308448800799/stfu.mp4")


@bot.command()
async def loan(ctx):
    with open('gambleid2.json', 'r') as f:
        gambleidlist = json.load(f)
        f.close()
        if str(ctx.author.id) not in gambleidlist.keys():
            gambleidlist.update({str(ctx.author.id): 1000})
            with open('gambleid2.json', 'w') as f:
                json.dump(gambleidlist, f)
                f.close()
        dpoints = int(gambleidlist[str(ctx.author.id)])
        if dpoints < 1:
            await ctx.send(f"How many points do you want to loan? You have {dpoints} points")
            newmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
            gambleidlist.pop(str(ctx.author.id))
            dpoints = int(dpoints) + int(newmsg.content)
            gambleidlist.update({str(ctx.author.id): dpoints})
            with open('gambleid2.json', 'w') as f:
                json.dump(gambleidlist, f)
                f.close()
            with open('debters.json', 'r') as z:
                debters1 = json.load(z)
                z.close()
            if str(ctx.author.id) not in debters1.keys():
                debters1.update({str(ctx.author.id): int(dpoints)})
            else:
                depoints = debters1[str(ctx.author.id)]
                debters1.pop(str(ctx.author.id))
                depoints = int(depoints) + int(newmsg.content)
                debters1.update({str(ctx.author.id): depoints})
            with open('debters.json', 'w') as z:
                json.dump(debters1, z)
                z.close()
            await ctx.send(f"You have {dpoints} points and owe {depoints} points")
        else:
            await ctx.send("You dont need no money!")


@bot.command()
async def googleit(ctx):
    await ctx.send(f"https://images-ext-2.discordapp.net/external/hIiIALXF1k8ET8jnVNQIdfzOSUeCSkppLBiMufRnqkg/https/i.imgur.com/X20kba7.mp4")


@bot.command()
@commands.has_role("God")
async def clear(ctx, amount):
    await ctx.channel.purge(limit=int(amount))


@bot.command()
async def bully(ctx, number: int, people, message):
    #await ctx.message.delete()
    if 11 > int(number) > 0:
        for x in range(number):
            await asyncio.sleep(random.randint(1, 10))
            await ctx.send(f"{people} is a feckin nerd! {message}")
    else:
        await ctx.send(f"{ctx.author.mention} is an idiot! (dont be a dingus)")


@bot.command()
async def sickbeats(ctx):
    with open('beats.json', 'r') as c:
        await ctx.send(str(random.choice(json.load(c))))
        c.close()


@bot.command()
async def randquote(ctx):
    with open('quotes.json', 'r') as v:
        await ctx.send(str(random.choice(json.load(v))))
        v.close()

@bot.command()
async def selftalker(ctx, message:str):
    await ctx.message.delete()
    await ctx.send(message)
@bot.command()
async def blackjack(ctx):
    with open('gambleid2.json', 'r') as f:
        gambleidlist = json.load(f)
        f.close()
        if str(ctx.author.id) not in gambleidlist.keys():
            gambleidlist.update({str(ctx.author.id): 1000})
            await ctx.send(f"first time eh? Dont loose all your money ;) {ctx.author}")
            with open('gambleid2.json', 'w') as f:
                json.dump(gambleidlist, f)
                f.close()
    points = gambleidlist[str(ctx.author.id)]
    await ctx.send(f"Please input how much you want to bet, you have {points}")
    newmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
    bettedpoints: int = newmsg.content
    newcards = [["2", "hearts", "2"], ["3", "hearts", "3"], ["4", "hearts", "4"], ["5", "hearts", "5"], ["6", "hearts", "6"],
                ["7", "hearts", "7"], ["8", "hearts", "8"], ["9", "hearts", "9"], ["10", "hearts", "10"], ["10", "hearts", "King"],
                ["10", "hearts", "Queen"], ["10", "hearts", "Jack"], ["11", "hearts", "Ace"], ["2", "spades", "2"],
                ["3", "spades", "3"], ["4", "spades", "4"], ["5", "spades", "5"], ["6", "spades", "6"], ["7", "spades", "7"],
                ["8", "spades", "8"], ["9", "spades", "9"], ["10", "spades", "10"], ["10", "spades", "King"], ["10", "spades", "Queen"],
                ["10", "spades", "Jack"], ["11", "spades", "Ace"], ["2", "clubs", "2"], ["3", "clubs", "3"], ["4", "clubs", "4"],
                ["5", "clubs", "5"], ["6", "clubs", "6"], ["7", "clubs", "7"], ["8", "clubs", "8"], ["9", "clubs", "9"],
                ["10", "clubs", "10"], ["10", "clubs", "King"], ["10", "clubs", "Queen"], ["10", "clubs", "Jack"], ["11", "clubs", "Ace"],
                ["2", "diamonds", "2"], ["3", "diamonds", "3"], ["4", "diamonds", "4"], ["5", "diamonds", "5"], ["6", "diamonds", "6"],
                ["7", "diamonds", "7"], ["8", "diamonds", "8"], ["9", "diamonds", "9"], ["10", "diamonds", "10"], ("10", "diamonds", "King"),
                ["10", "diamonds", "Queen"], ["10", "diamonds", "Jack"], ["11", "diamonds", "Ace"]]
    hitlist = [("third"), ("fourth"), ("fifth"), ("sixth"), ("seventh"), ("eight"), ("ninth"), ("tenth"), ("eleventh")]
    random.shuffle(newcards)
    if int(bettedpoints) > int(points):
        await ctx.send(f"BREAKING NEWS, {ctx.author} is a flaming idiot (dont bet more than you own)")
    elif int(bettedpoints) < 1:
        await ctx.send(f"BREAKING NEWS, {ctx.author} is a flaming idiot (dont bet negative money idiot)")
    else:
        playercardlist: list = []
        dealercardlist: list = []
        acelist: list = []
        dealeracelist: list = []
        for x in range(2):
            dealercardlist.append(newcards.pop())
            playercardlist.append(newcards.pop())
        if int(dealercardlist[0][0]) == int(11):
            dealercardlist[0].append(0)
            dealeracelist.append(dealercardlist[0])
        if int(dealercardlist[1][0]) == int(11):
            dealercardlist[1].append(1)
            dealeracelist.append(dealercardlist[1])
        playertotalpoints = int(playercardlist[0][0]) + int(playercardlist[1][0])
        if int(dealercardlist[0][0]) == int(11) and int(dealercardlist[1][0]) == int(11):
            dealercardlist[0][0] = 1
        dealerfnlpoints = int(dealercardlist[0][0]) + int(dealercardlist[1][0])
        dealerbroke: bool = False
        runtimenum = 1
        while int(dealerfnlpoints) < int(17):
            runtimenum = int(runtimenum) + 1
            print(runtimenum)
            dealercardlist.append(newcards.pop())
            if int(dealercardlist[int(runtimenum)][0]) == int(11) and int(dealerfnlpoints) > int(10):
                dealercardlist[int(runtimenum)][0] = 1
                dealercardlist[int(runtimenum)].append(int(runtimenum))
                dealeracelist.append(dealercardlist[int(runtimenum)])
            if int(dealercardlist[int(runtimenum)][0]) == int(11):
                dealercardlist[int(runtimenum)].append(int(runtimenum))
                dealeracelist.append(dealercardlist[int(runtimenum)])
            dealerfnlpoints = int(dealerfnlpoints) + int(dealercardlist[int(runtimenum)][0])
            if int(dealerfnlpoints) > int(21):
                if not dealeracelist == []:
                    for x in range(len(dealeracelist)):
                        if int(dealeracelist[x][0]) == int(11) and int(dealerfnlpoints) > int(21):
                            dealeracelist[x][0] = 1
                            dealerfnlpoints = int(dealerfnlpoints) - 10
                if int(dealerfnlpoints) > 21:
                    dealerbroke: bool = True
                    break
            elif int(dealerfnlpoints) > int(16):
                break
        print(dealercardlist)
        print(dealeracelist)
        print(dealerfnlpoints)
        insurancemoney = 0
        insurance = False
        await ctx.send(f"I reveal a {dealercardlist[0][2]} of {dealercardlist[0][1]} and have {int(runtimenum)} hidden")
        if int(dealercardlist[0][0]) == int(1) or int(dealercardlist[0][0]) == int(11):
            await ctx.send("Would you like insurance? If I end up with a Blackjack you get half your money back.")
            newmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
            newmsg.content = newmsg.content.lower()
            if newmsg.content == "yes":
                insurancemoney: int = math.floor(int(bettedpoints) / 2)
                points = int(points) - int(insurancemoney)
                await ctx.send(f"You have purchased {insurancemoney} points of insurance")
                insurance = True
            else:
                await ctx.send(f"You did not buy insurance")
        # player turn
        playeturnnum = 2
        await ctx.send(f"You get a {playercardlist[0][2]} of {playercardlist[0][1]}, and a {playercardlist[1][2]} of {playercardlist[1][1]}")
        if int(playercardlist[0][0]) == int(11):
            await acechecker(playercardlist[0], ctx)
            playercardlist[0].append(0)
            acelist.append(playercardlist[0])
        if int(playercardlist[1][0]) == int(11):
            await acechecker(playercardlist[1], ctx)
            playercardlist[1].append(1)
            acelist.append(playercardlist[1])
        playertotalpoints = int(playercardlist[0][0]) + int(playercardlist[1][0])
        playerpast21: bool = False
        surrender: bool = False
        doubledown: bool = False
        cardlistcontent: str = f"A {playercardlist[0][2]} of {playercardlist[0][1]}, A {playercardlist[1][2]} of {playercardlist[1][1]}, "
        while True:
            await ctx.send(
                f"Would you like to hit, stand, surrender, or double down, adjust aces, current points = {playertotalpoints}")
            newmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
            newmsg.content = str(newmsg.content).lower()
            if newmsg.content == "surrender":
                await ctx.send("You surrender")
                surrender = True
                break
            elif newmsg.content == "double down":
                playerturnnum = 3
                playercardlist.append(newcards.pop())
                await ctx.send(f"Your third and final card is {playercardlist[2][2]} of {playercardlist[2][1]}")
                playerpast21, playertotalpoints, cardlistcontent, acelist = await blackjack3rdturn(ctx, playercardlist, int(playertotalpoints), int(playerturnnum), cardlistcontent, acelist)
                await ctx.send("Will the double bet be worth it?")
                doubledown = True
                break
            elif str(newmsg.content) == "adjust aces":
                if not acelist == []:
                    playertotalpoints, playercardlist, acelist = await aceswitcher(ctx, playercardlist, acelist, playertotalpoints)
                else:
                    await ctx.send("you dont have any aces idiot.")
            elif str(newmsg.content) == "hit":
                break
            elif str(newmsg.content) == "stand":
                break
        while True:
            if newmsg.content == "hit":
                playeturnnum = int(playeturnnum) + 1
                playercardlist.append(newcards.pop())
                await ctx.send(f"Your {hitlist[(int(playeturnnum) - 3)]} card is {playercardlist[(int(playeturnnum) - 1)][2]} of {playercardlist[(int(playeturnnum) - 1)][1]}")
                playerpast21, playertotalpoints, cardlistcontent, acelist = await blackjack3rdturn(ctx, playercardlist, int(playertotalpoints), int(playeturnnum), cardlistcontent, acelist)
                if playerpast21:
                    break
            elif str(newmsg.content) == "stand":
                await ctx.send("How will you fare?")
                if int(playertotalpoints) > int(21):
                    playerpast21 = True
                break
            elif str(newmsg.content) == "adjust aces":
                if not acelist == []:
                    playertotalpoints, playercardlist, acelist = await aceswitcher(ctx, playercardlist, acelist, playertotalpoints)
                else:
                    await ctx.send("You dont have any aces idiot.")
            elif str(newmsg.content) == "double down":
                break
            elif str(newmsg.content) == "surrender":
                break
            await ctx.send(f"hit, stand or adjust aces?")
            newmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
            newmsg.content = str(newmsg.content).lower()
        while True:

            if not acelist == [] and not int(playertotalpoints) == 21:
                while True:
                    await ctx.send("Last chance to adjust aces! adjust aces or leave")
                    newmsg = await bot.wait_for('message', check=lambda message: message.author == ctx.author)
                    newmsg.content = str(newmsg.content).lower()
                    if newmsg.content == "adjust aces":
                        playertotalpoints, playercardlist, acelist = await aceswitcher(ctx, playercardlist, acelist,
                                                                                   playertotalpoints)
                    elif newmsg.content == "leave":
                        break
            content = "I had "
            for x in range(len(dealercardlist)):
                content = str(content) + f"A {dealercardlist[x][2]} of {dealercardlist[x][1]}, "
            content = str(content) + "as my hand"
            await ctx.send(content)
            if not playerpast21:
                if int(playertotalpoints) > int(dealerfnlpoints) or dealerbroke:
                    #player win
                    if int(playertotalpoints) == int(21) and dealerbroke: #player blackjack dealer broke
                        fnl_message = "You got a blackjack and I broke."
                        points = await goodend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown,
                                fnl_message,
                                dealerfnlpoints, playertotalpoints)
                        break
                        # player blackjack and dealer broke
                    elif int(playertotalpoints) == int(21) and int(playertotalpoints) > int(dealerfnlpoints):
                        fnl_message = f"You got a blackjack and I had {dealerfnlpoints} points."
                        points = await goodend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown,
                                fnl_message,
                                dealerfnlpoints, playertotalpoints)
                        break
                        # player beat dealer with blackjack
                    elif dealerbroke:
                        fnl_message = f"You have {playertotalpoints} points and I broke."
                        points = await goodend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown,
                                fnl_message, dealerfnlpoints, playertotalpoints)
                        break
                        # dealer broke player didnt
                    elif int(playertotalpoints) > int(dealerfnlpoints):
                        fnl_message = f"You {playertotalpoints} points and I had {dealerfnlpoints}."
                        points = await goodend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message,
                               dealerfnlpoints, playertotalpoints)
                        break
                        # player wins
                elif int(playertotalpoints) < int(dealerfnlpoints) and not dealerbroke:
                    #player lose
                    if int(dealerfnlpoints) == int(21) and int(playertotalpoints) < int(dealerfnlpoints):
                        fnl_message = f"I got a blackjack and you had {playertotalpoints}."
                        points = await badend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message,
                               dealerfnlpoints)
                        break
                        # dealer beat player with blackjack
                    elif int(dealerfnlpoints) > int(playertotalpoints):
                        fnl_message = f"I had {dealerfnlpoints} points and you had {playertotalpoints} points."
                        points = await badend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message,
                               dealerfnlpoints)
                        break
                        # dealer wins
                elif int(playertotalpoints) == int(dealerfnlpoints):
                    if int(dealerfnlpoints) == int(21) and int(dealerfnlpoints) == int(playertotalpoints):
                        fnl_message = "We both got a blackjack!."
                        points = await neutralend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message, dealerfnlpoints)
                        break
                        # tie both blackjack
                    elif int(dealerfnlpoints) == int(playertotalpoints):
                        fnl_message = f"We both tied with a {playertotalpoints}."
                        points = await neutralend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message, dealerfnlpoints)
                        break
                        # tie no blackjack or broke
                    #tie
            elif playerpast21 and dealerbroke:
                fnl_message = "we both broke so can call it a tie."
                points = await neutralend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message, dealerfnlpoints)
                break
                # both broke
            elif playerpast21 and int(dealerfnlpoints) == int(21):
                fnl_message = f"you broke and I got a blackjack, sucks to suck"
                points = await badend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message,
                           dealerfnlpoints)
                break
            elif playerpast21 and not dealerbroke:
                fnl_message = f"You broke and I had {dealerfnlpoints}, sucks to suck."
                points = await badend(ctx, insurance, insurancemoney, surrender, points, bettedpoints, doubledown, fnl_message,
                           dealerfnlpoints)
                break
                # player broke dealer didnt
    gambleidlist.pop(str(ctx.author.id))
    gambleidlist.update({str(ctx.author.id): points})
    with open('gambleid2.json', 'w') as f:
        json.dump(gambleidlist, f)
        f.close()
    with open('debters.json', 'r') as z:
        debeters = json.load(z)
        if str(ctx.author.id) in debeters.keys():
            if not int(debeters[str(ctx.author.id)]) == int(0):
                dpoints = math.floor(int(debeters[str(ctx.author.id)]) * 1.07)
                debeters.pop(str(ctx.author.id))
                debeters.update({str(ctx.author.id): dpoints})
                await ctx.send(f"You now owe {dpoints} points")
        z.close()
    with open('debters.json', 'w') as z:
        json.dump(debeters, z)
        z.close()


@bot.event
async def on_message_delete(message):
    if not str(message.author.id) == "804417957768855563":
        channel = bot.fetch_channel(guildstuff[str(message.guild.id)][0])
        await channel.send(f"{message.member.name} deleted a message\nThis is the message that he has deleted\n{message.content}")


@bot.event
async def on_message_edit(message_before, message_after):
    if not message_before.author.id == "804417957768855563":
        channel = await bot.fetch_channel(guildstuff[str(message_after.guild.id)][0])
        await channel.send(f"{message_before.author.name} edited a message\nThis is the message before any edit\n{message_before.content}\nthis is the message after\n{message_after.content}")

@bot.event
async def on_raw_reaction_remove(payload):
    if str(payload.emoji) in "\U00002b06\U0000fe0f":
        ogmessagechannel = await bot.fetch_channel(payload.channel_id)
        ogmessage = await ogmessagechannel.fetch_message(payload.message_id)
        reaction = get(ogmessage.reactions, emoji=payload.emoji.name)
        if reaction and reaction.count > 0:
            channel = await bot.fetch_channel(guildstuff[str(payload.guild_id)][1])
            with open('board.json', 'r') as a:
                starboardmsg = json.load(a)
                a.close()
            if not str(starboardmsg) == str(ogmessage.id):
                await channel.send(f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_up:")
                with open('board.json', 'w') as a:
                    json.dump(ogmessage.id, a)
                    a.close()
            else:
                message = await channel.history(limit=1).flatten()
                message = message[0]
                await message.edit(content=f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_up:")
        elif reaction == None:
            channel = await bot.fetch_channel(guildstuff[str(payload.guild_id)][1])
            with open('board.json', 'r') as a:
                starboardmsg = json.load(a)
                a.close()
            if str(starboardmsg) == str(ogmessage.id):
                message = await channel.history(limit=1).flatten()
                message = message[0]
                await message.edit(
                    content=f"{ogmessage.content}\nby {ogmessage.author.name} with 0 :arrow_up:")
    elif str(payload.emoji) in "\U00002b07\U0000fe0f":
        ogmessagechannel = await bot.fetch_channel(payload.channel_id)
        ogmessage = await ogmessagechannel.fetch_message(payload.message_id)
        reaction = get(ogmessage.reactions, emoji=payload.emoji.name)
        if reaction and reaction.count > 0:
            channel = await bot.fetch_channel(guildstuff[str(payload.guild_id)][2])
            with open('duncelist.json', 'r') as m:
                starboardmsg = json.load(m)[0]
                m.close()
            if not str(starboardmsg) == str(ogmessage.id):
                await channel.send(f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_down: \n{ogmessage.author.name} is the new dunce!")
                with open('duncelist.json', 'w') as m:
                    json.dump(ogmessage.id, m)
                    m.close()
            else:
                message = await channel.history(limit=1).flatten()
                message = message[0]
                await message.edit(content=f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_down: \n{ogmessage.author.name} is the new dunce!")
        elif reaction == None:
            channel = await bot.fetch_channel(guildstuff[str(payload.guild_id)][1])
            with open('duncelist.json', 'r') as m:
                starboardmsg = json.load(m)[0]
                m.close()
            if str(starboardmsg) == str(ogmessage.id):
                message = await channel.history(limit=1).flatten()
                message = message[0]
                await message.edit(
                    content=f"{ogmessage.content}\nby {ogmessage.author.name} with 0 :arrow_down: \n{ogmessage.author.name} is the new dunce!")


@bot.event
async def on_raw_reaction_add(payload):
    if str(payload.emoji) in "\U00002b06\U0000fe0f":
        ogmessagechannel = await bot.fetch_channel(payload.channel_id)
        ogmessage = await ogmessagechannel.fetch_message(payload.message_id)
        reaction = get(ogmessage.reactions, emoji=payload.emoji.name)
        if reaction and reaction.count > 0:
            channel = await bot.fetch_channel(guildstuff[str(payload.guild_id)][1])
            with open('board.json', 'r') as a:
                starboardmsg = json.load(a)
                a.close()
            if not str(starboardmsg) == str(ogmessage.id):
                await channel.send(f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_up:")
                with open('board.json', 'w') as a:
                    json.dump(ogmessage.id, a)
                    a.close()
            else:
                message = await channel.history(limit=1).flatten()
                message = message[0]
                await message.edit(content=f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_up:")
    elif str(payload.emoji) in "\U00002b07\U0000fe0f":
        ogmessagechannel = await bot.fetch_channel(payload.channel_id)
        ogmessage = await ogmessagechannel.fetch_message(payload.message_id)
        guild = bot.get_guild(int(payload.guild_id))
        reaction = get(ogmessage.reactions, emoji=payload.emoji.name)
        if reaction and reaction.count > 0:
            channel = await bot.fetch_channel(guildstuff[str(payload.guild_id)][2])
            with open('duncelist.json', 'r') as m:
                starboardmsg = json.load(m)[0]
                m.close()
            if not str(starboardmsg) == str(ogmessage.id):
                await channel.send(f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_down: \n{ogmessage.author.name} is the new dunce!")
                with open('duncelist.json', 'r') as m:
                    dunceperson = json.load(m)[1]
                    m.close()
                newdunceperson = guild.get_member(int(ogmessage.author.id))
                dumpthing: list = [str(ogmessage.id), str(newdunceperson.id)]
                dunceperson = guild.get_member(int(dunceperson))
                guild = bot.get_guild(int(payload.guild_id))
                role = get(guild.roles, id=819257625794445332)
                await dunceperson.remove_roles(role)
                await newdunceperson.add_roles(role)
                with open('duncelist.json', 'w') as m:
                    json.dump(dumpthing, m)
                    m.close()
            else:
                message = await channel.history(limit=1).flatten()
                message = message[0]
                await message.edit(
                    content=f"{ogmessage.content}\nby {ogmessage.author.name} with {reaction.count} :arrow_down: \n{ogmessage.author.name} is the new dunce!")


@bot.event
async def on_message(ctx):
    if not ctx.author.id == "804417957768855563":
        ctx.content = ctx.content.lower()#badword checker
        message: list = ctx.content.split()
        for x in range(len(message)):
            break
            if message[x] in badwordlist:
                await ctx.delete()
                break
    if str(ctx.author.id) == "740453233008312367":
        global worduse
        print(worduse)
        worduse = int(worduse) + 1
        if int(worduse) == int(5):
            await ctx.channel.send("JESSEBBBBB")
            worduse = 0
    global chat
    if chat:
        if "784664131411116053" in str(ctx.author.roles) and str(ctx.content).lower() == "stop":
            chat = False
        elif "821057108622442567" in str(ctx.author.roles) and str(ctx.content).lower() == "stop":
            chat = False
        elif "784663741983621121" in str(ctx.author.roles) and str(ctx.content).lower() == "stop":
            chat = False
        elif "784664300475777054" in str(ctx.author.roles) and str(ctx.content).lower() == "stop":
            chat = False
    await bot.process_commands(ctx)


with open('notouch.json', 'r') as b:
    bob = json.load(b)
bot.run(str(bob))
